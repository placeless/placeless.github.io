---
layout: post
title: 'Python æ•°æ®å¯è§†åŒ–å·¥å…·é›† 2024'
date: 2024-01-03 01:20 +0800
---


å€Ÿç”¨ [R4DS](https://r4ds.had.co.nz/explore-intro.html) ä¸€ä¹¦ä¸­å¯¹æ•°æ®æ¢ç´¢å·¥ä½œçš„æè¿°ï¼Œä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªå…³é”®éƒ¨ä»¶ï¼š**æ•°æ®è½¬æ¢**ã€**å¯è§†åŒ–å›¾è¡¨**ã€**æ•°å­¦å»ºæ¨¡**ã€‚ä¸€ç›´ä»¥æ¥ï¼Œåœ¨ EDA åœºæ™¯ä¸­ï¼Œæˆ‘è‡ªå·±ä½¿ç”¨ R & Python çš„å¼ºåº¦æ˜¯äº”äº”å¼€ï¼Œç”šè‡³ç•¥å¾®æ›´åå‘ R ä¸€äº›ã€‚å› ä¸º R å®‡å®™æœ‰ [Tidyverse](https://tidyverse.org/)ã€[data.table](https://rdatatable.gitlab.io/data.table/) è¿™äº›å·¥å…·é›†ï¼Œéƒ½æ”¯æŒç®¡é“ï¼Œä¸”è¯­æ³•ç®€æ˜ã€é€»è¾‘ä¼˜é›…ï¼Œå€ŸåŠ© RStudio å’Œ RMarkdownï¼Œæ•°æ®åˆ†ææ•ˆç‡å¾ˆé«˜ã€‚è€Œ Python + Jupyter + Pandas è¿™è¾¹ï¼Œå¾€å¾€æ“ä½œç¨æ˜¾ç½—å—¦ï¼Œç»„ç»‡ä¸»é¢˜æ›´åŠ éº»çƒ¦ä¸€äº›ã€‚

è¿›å…¥ 2023 å¹´ä¹‹åï¼ŒPython çš„ä½¿ç”¨æ¯”é‡å°±å¤§çš„å¤šäº†ï¼Œä¸»è¦åŸå› æœ‰ä¸¤ä¸ªï¼šä¸€æ˜¯å› ä¸º [Polars](https://pola.rs/)ï¼›äºŒæ˜¯å› ä¸º [Quarto](https://quarto.org/)ã€‚Polars æ—¥è‡»æˆç†Ÿå’Œæµè¡Œï¼Œå®ƒå…¼é¡¾äº†è¯­ä¹‰çš„ä¼˜é›…å’Œæ€§èƒ½çš„é«˜æ•ˆï¼Œæ–°å¼•å…¥çš„æŠ½è±¡æ¦‚å¿µå’Œ API å¸¦æ¥çš„ã€Œå¿ƒæ™ºè´Ÿæ‹…ã€ä¹Ÿä¸ç®—é«˜ï¼Œæ— è®ºæ˜¯ä» Pandas è¿˜æ˜¯ Tidyverse è¿‡æ¸¡è€Œæ¥ï¼Œéƒ½éå¸¸å®¹æ˜“ã€‚å¯¹äºå–œæ¬¢ R ç®¡é“çš„æœ‹å‹ï¼ŒPolars æä¾›çš„é“¾å¼ APIï¼Œæ›´æ˜¯å¸®æˆ‘ä»¬åœ¨ Python ç¯å¢ƒé‡Œæ‰¾åˆ°äº†å®¶ã€‚å†è¯´ Quartoï¼ŒRStudio/Posit å¯èƒ½ All in Quartoï¼ŒæœŸæœ›é€šè¿‡ Quarto æ¥åŒ…å« R/Python çš„ä¸€åˆ‡ï¼Œæ¥å¯¹æŠ— Jupyterã€‚ç„¶æ—¶è‡³ä»Šæ—¥ï¼Œå¦‚æœç”¨æˆ·ä¸è¿›å…¥ RStudio Appï¼Œå»æ‰‹åŠ¨é“¾æ¥å„ç§ dart-sassã€denoã€esbuildï¼Œåœ¨è‹¹æœ M ç³»åˆ—èŠ¯ç‰‡ä¸Šï¼Œ`.qmd` æ–‡ä»¶è¿˜æ˜¯è·‘ä¸èµ·æ¥ï¼Œå‹‰å¼ºè·‘èµ·æ¥äº†ï¼Œä¸çŸ¥ä¸è§‰åˆåˆ‡å›äº†æ›´ä¸ºç†Ÿæ‚‰è½»é‡çš„ Rmdã€‚åŠ ä¹‹ä»Šå¤©åˆçœ‹åˆ° [Yihui Down](https://yihui.org/en/2024/01/bye-rstudio/)ï¼Œç›¸å½“éš¾è¿‡ã€‚Anywayï¼ŒGood luck and have fun.

æˆ‘å‡ ä¹å·²ç»å®Œå…¨ç”¨ Polars æ›¿æ¢æ‰äº† Pandas å’Œ Tidyverseã€‚å”¯æœ‰ä¸¤ç‚¹é—æ†¾ï¼Œä¸€æ˜¯ Polars æ²¡æœ‰å†…ç½®çš„å›¾è¡¨æ¥å£ï¼ŒäºŒæ˜¯è¿˜ä¸èƒ½æ— ç¼å…³è”æ¨¡å‹åº“ã€‚ä¸è¿‡ï¼Œè¿™ä¸¤ç‚¹éƒ½å¯ä»¥é€šè¿‡è°ƒç”¨æ¯”å¦‚ `.to_pandas()`ï¼Œå°† DataFrame è½¬æ¢æˆç›¸åº”çš„å…¼å®¹æ•°æ®å½¢å¼ä¹‹åï¼Œå†è¿›è¡Œå¤„ç†ã€‚åè€…ï¼Œåº”è¯¥è¿˜éœ€è¦ä¸å°‘çš„æ—¶é—´ï¼Œè€Œè‡³äºå‰ä¸€ä¸ªé—æ†¾ï¼Œåœ¨æœ€è¿‘å‡ å¤©å‘å¸ƒçš„ `0.20.3` ç‰ˆä¸­è§£å†³äº†ã€‚ç°åœ¨ Polars ä¹Ÿå†…ç½®äº†ç±»ä¼¼ Pandas `df.plot` æ–¹å¼çš„ç»˜å›¾æ¥å£ ğŸ”¥ï¼Œå¿…é¡»èµ¶ç´§ä½“éªŒä¸€ä¸‹ï¼Œå¹¶ä¸”è·Ÿ Python ç”Ÿæ€é‡Œæˆ‘å¸¸ç”¨çš„ç»˜å›¾åº“åšä¸ªå¯¹æ¯”ï¼Œåšä¸ªå–èˆã€‚

ä»¥ä¸Šç¯‡[æˆ‘åœ¨ YouTube ä¸Šçœ‹äº†äº›å•¥](https://placeless.net/blog/my-footprint-on-youtube)çš„æ•°æ®é›†ä¸ºä¾‹ï¼Œåšä¸¤ä»¶äº‹ï¼Œä¸€æ˜¯åˆ†åˆ«ä½¿ç”¨å„ä¸ªå¯è§†åŒ–æ¡†æ¶ï¼Œåˆ†åˆ«åˆ¶ä½œæ¯æœˆæ¯ä¸ªæ—¶æ®µçš„çƒ­åŠ›å›¾ï¼ˆheatmapï¼‰å’Œæ¯å¹´çš„å†…å®¹åˆ†ç±»æ’åå›¾ï¼ˆbump chartï¼‰ï¼›äºŒæ˜¯å°†ä¸¤é™„å›¾åˆåœ¨ä¸€èµ·ï¼Œæ¢ç´¢ä¸€ä¸‹å„æ¡†æ¶çš„å¤šå›¾å¸ƒå±€åŠŸèƒ½ã€‚


```python
import polars as pl

df = pl.read_parquet("./history_aio.parquet")
pl.__version__
```




    '0.20.4'




```python
heatmap_dat = (
    # æŒ‘å‡º 2023 å¹´
    df.filter(pl.col("year") == 2023)
    # æŒ‰æœˆã€å°æ—¶æ®µï¼Œåš count
    .group_by("month", "hour")
    .agg(
        pl.count().alias("n"),
    )
    # é€è§†æ‹‰å®½ã€è¡¥åˆ—ï¼Œå®Œæ•´ 24 å°æ—¶
    .pivot(index="month", columns="hour", values="n")
    .with_columns(
        pl.lit(None).alias("4"), pl.lit(None).alias("5"), pl.lit(None).alias("6")
    )
    .select(["month"] + [str(c) for c in range(1, 24)])
    # èåŒ–è¿˜åŸæˆé•¿è¡¨
    .melt(id_vars="month", variable_name="hour", value_name="n")
    # å˜æ¢ç±»å‹å¹¶æ’åº
    .with_columns(pl.col("hour").cast(pl.Int8))
    .sort("month", "hour")
)
```


```python
heatmap_dat.head()
```




<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 3)</small><table border="1" class="dataframe"><thead><tr><th>month</th><th>hour</th><th>n</th></tr><tr><td>i8</td><td>i8</td><td>u32</td></tr></thead><tbody><tr><td>1</td><td>1</td><td>17</td></tr><tr><td>1</td><td>2</td><td>1</td></tr><tr><td>1</td><td>3</td><td>null</td></tr><tr><td>1</td><td>4</td><td>null</td></tr><tr><td>1</td><td>5</td><td>null</td></tr></tbody></table></div>




```python
bump_dat = (
    # æŒ‘å‡ºæœ‰æ•ˆç±»åˆ«è¡Œ
    df.filter(pl.col("cat_name").is_not_null())
    # æŒ‰å¹´ã€ç±»ï¼Œcount è§†é¢‘å”¯ä¸€é‡
    .group_by("year", "cat_name").agg(pl.n_unique("title").alias("n_video"))
    # æŒ‰é‡å¤§å°ï¼Œæ’å
    .with_columns(
        pl.col("n_video").rank("ordinal", descending=True).over("year").alias("ranking")
    )
    # æŒ‰å¹´æ’åº
    .sort("year")
)
```


```python
bump_dat.head()
```




<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 4)</small><table border="1" class="dataframe"><thead><tr><th>year</th><th>cat_name</th><th>n_video</th><th>ranking</th></tr><tr><td>i32</td><td>str</td><td>u32</td><td>u32</td></tr></thead><tbody><tr><td>2016</td><td>&quot;People &amp; Blogsâ€¦</td><td>44</td><td>4</td></tr><tr><td>2016</td><td>&quot;Sports&quot;</td><td>14</td><td>9</td></tr><tr><td>2016</td><td>&quot;Howto &amp; Style&quot;</td><td>41</td><td>5</td></tr><tr><td>2016</td><td>&quot;Autos &amp; Vehiclâ€¦</td><td>3</td><td>13</td></tr><tr><td>2016</td><td>&quot;Film &amp; Animatiâ€¦</td><td>25</td><td>7</td></tr></tbody></table></div>



## Polars & hvPlot

Polars å¹¶æ²¡æœ‰è‡ªè¡Œå®ç°ç»˜å›¾é€»è¾‘ï¼Œå®ƒçš„ `.plot` æ˜¯é€šè¿‡çš„ [hvPlot](https://hvplot.holoviz.org/index.html) æ¥ä»£ç†çš„ï¼ˆè€Œ hvPlot é»˜è®¤çš„åç«¯åˆæ˜¯ [bokeh](https://bokeh.org/)ï¼Œæ‰€ä»¥å¦‚æœåœ¨ Notebook ç¯å¢ƒä¸­å›¾è¡¨æœªæ­£ç¡®æ˜¾ç¤ºï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ­£ç¡®æ˜¾ç¤ºå›¾è¡¨ï¼‰ã€‚


```python
# from bokeh.io import output_notebook

# output_notebook()
```


```python
fig1 = heatmap_dat.plot.heatmap(
    x="hour", y="month", C="n", cmap="reds", title="Heatmap"
).options(toolbar=None, default_tools=[])

fig1
```




<iframe id="fig1" frameborder=0 height="500px" width="100%" src="/files/charts/fig1.html"></iframe>



çƒ­åŠ›å›¾æ˜¯ hvPlot é¢„ç½®çš„æ¨¡æ¿å›¾è¡¨ï¼Œæ‰€ä»¥ä¸€è¡Œä»£ç ï¼Œç®€å•æ˜ å°„ä¸€ä¸‹ xy è½´ï¼Œå†æŒ‡å®šä¸€ä¸‹é¢œè‰²ï¼Œå³å¯å®ç°ç›¸å½“ä¸é”™çš„æ•ˆæœã€‚å¯¹äº bokeh åç«¯ï¼Œå¦‚æœä¸æƒ³çœ‹è§å®ƒçš„å·¥å…·æ ï¼Œä¸å–œæ¬¢å®ƒé»˜è®¤å¯ç”¨çš„ç¼©æ”¾æ•ˆæœï¼Œæˆ‘ä»¬ä¹Ÿåªéœ€è¦åœ¨ `.plot` ä¹‹åè·Ÿ `.opts` æˆ–è€… `.options` æŠŠå®ƒä»¬å…³æ‰å³å¯ã€‚

æ’åå˜åŒ–å›¾ Bump Chart å¹¶é hvPlot é¢„ç½®æ¨¡æ¿ï¼Œéœ€è¦è‡ªè¡Œå®ç°ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶åˆ†è§£ä¸ºæ•£ç‚¹å›¾å’Œæ¡çº¿å›¾çš„ç»“åˆä½“ï¼Œåˆ†ä½œåˆ¶ä½œè¿™ä¸¤è€…ï¼Œç„¶åå°†å…¶åˆäºŒä¸ºä¸€ã€‚


```python
fig2 = (
    bump_dat.plot.line(x="year", y="ranking", by="cat_name")
    * bump_dat.plot.scatter(x="year", y="ranking", by="cat_name")
).opts(
    title="Bump Chart",
    toolbar=None,
    default_tools=[],
    invert_yaxis=True,
    legend_opts=dict(border_line_width=0, label_text_font_size="6pt", label_height=2),
    padding=0.05,
    height=480,
)

fig2
```






<iframe id="fig2" frameborder=0 height="500px" width="100%" src="/files/charts/fig2.html"></iframe>



å¾®è°ƒçš„å›¾è¡¨å‚æ•°ï¼Œå¯ä»¥å¤§èƒ†å‡è®¾ï¼Œå…ˆå¡«è¿›å»ï¼Œè„šæœ¬æŠ¥é”™ä¹‹åï¼Œæ¡†æ¶æ ¹æ®ä½ çš„å¡«å†™ï¼Œä¼šè´´å¿ƒçš„çˆ†å‡ºå®ƒçš„åˆç†æ¨æµ‹æˆ–æ”¯æŒçš„å‚æ•°é›†ï¼Œå¦‚æ­¤ä¸¤ä¸‰ä¸ªæ¥å›ï¼Œå†ç»“åˆæ–‡æ¡£ï¼Œå®ç°æƒ³è¦çš„å›¾è¡¨æ•ˆæœï¼Œé—¨æ§›ä¹Ÿä¸ç®—å¤ªé«˜ã€‚ä¸Šå›¾æ¯”è¾ƒæ‰“çœ¼çš„éƒ¨åˆ†æ˜¯å³è¾¹çš„å›¾ä¾‹ï¼ˆlegendï¼‰æ ï¼Œå®ƒçš„æ’åºæ²¡æœ‰èƒ½è·Ÿç¦»å®ƒæœ€è¿‘çš„ 2023 å¹´æ’åä¿æŒä¸€è‡´ï¼Œè§‚æ„Ÿä¸å¥½ã€‚æˆ‘ä»¬å¯ä»¥å•ç‹¬å¯¹å®ƒè¿›è¡Œé‡æ’ï¼Œæˆ–è€…æ‹¿æ‰å®ƒä¹‹åå•ç‹¬å¯¹ 2023 çš„æ’ååš label æ ‡æ³¨ã€‚ä¸è¿‡è¿™ä¸ªè¿‡ç¨‹åœ¨è¿™é‡Œä¼¼ä¹éƒ½ä¸åŒå®¹æ˜“å®ç°ï¼Œä¸”å…ˆç•™ç©ºã€‚

```python
AttributeError: unexpected attribute 'border_width' to Legend, similar attributes are border_line_width, border_line_dash or label_width
```

å›¾å†…å åŠ ç”¨ `*`ï¼Œè€Œå¤šå›¾å †å ä¹Ÿéå¸¸æ–¹ä¾¿ï¼Œç”¨ `+` å³å¯ã€‚


```python
fig3 = (fig1.opts(height=480) + fig2).opts(toolbar=None)
fig3
```






<iframe id="fig3" frameborder=0 height="500px" width="100%" src="/files/charts/fig3.html"></iframe>



## Altair

äº¤äº’å¼å›¾è¡¨åº“ï¼Œæˆ‘æœ€æ—©ç”¨çš„æ˜¯ [Altair](https://altair-viz.github.io/index.html)ã€‚Altair çš„è¯­æ³•ç»“æ„ä¸ç®—å¤æ‚ï¼Œä½¿ç”¨æ—¶ä¹Ÿæ¯”è¾ƒç¬¦åˆç›´è§‰ï¼Œ `Chart().mark_x().encode()...properties()` ä¸€è·¯ä¸²ä¸‹å»ï¼Œ`Chart` åƒæ•°æ®ï¼Œ`mark_x` åƒå½¢çŠ¶ï¼Œ`encode` åƒé…ç½®ï¼Œ`properties` åšä¸€äº›æ‰¾è¡¥ã€‚ç‰¹åˆ«æœ‰æ„æ€çš„æ˜¯ï¼Œåœ¨ä¸²è”ç¯èŠ‚å½“ä¸­ï¼ŒAltair è¿˜å¼•å…¥äº†ä¾¿æ·çš„æ•°æ®å˜æ¢æœºåˆ¶ï¼Œæ–¹ä¾¿ç”¨æˆ·æ“ä½œæ•°æ®ã€‚å¹¶ä¸”æ–‡æ¡£å’Œ API ç»„ç»‡çš„ç›¸å½“å¥½ï¼Œä½¿ç”¨æ—¶æ²¡æœ‰ Plotlyã€Bokeh é‚£ä¹ˆæ¾æ•£çš„æ„Ÿè§‰ï¼Œé‡åˆ°é—®é¢˜æ—¶ï¼ŒæŒ‰å›¾ç´¢éª¥ä¹Ÿæ¯”è¾ƒé€šç•…ã€‚


```python
import altair as alt

alt.__version__
```




    '5.2.0'




```python
fig4 = (
    # åƒæ•°æ®
    alt.Chart(heatmap_dat.fill_null(0))
    # ç”»æ–¹å—
    .mark_rect()
    # å¾®è°ƒé…ç½®
    .encode(
        # x åŠå…¶æ•°æ®ç±»å‹
        x="hour:O",
        # y åŠå…¶æ•°æ®ç±»å‹ã€æ’åºæ–¹å¼
        y=alt.Y("month:O", sort="descending"),
        # color å¡«å……è§„åˆ™
        color=alt.condition(
            "datum.n != 0", alt.Color("n:Q").scale(scheme="reds"), alt.value("white")
        ),
        # æ‚¬åœä¿¡æ¯
        tooltip=[
            alt.Tooltip("month"),
            alt.Tooltip("hour"),
            alt.Tooltip("n:Q", title="# of videos"),
        ],
    )
    # è¡¥å……å®šä¹‰
    .properties(title="Heatmap", width=500, height=300)
)

fig5 = (
    alt.Chart(bump_dat)
    # ç”»çº¿ã€æ ‡ç‚¹
    .mark_line(point=True)
    .encode(
        x="year:O",
        y=alt.Y("ranking:Q", sort="descending"),
        # å¡«å……ä¸”å¹²é¢„æ’åº
        color=alt.Color(
            "cat_name",
            sort=[
                "Science & Technology",
                "People & Blogs",
                "Film & Animation",
                "Education",
                "Gaming",
                "Entertainment",
                "Howto & Style",
                "Music",
                "Travel & Events",
                "Sports",
                "News & Politics",
                "Pets & Animals",
                "Autos & Vehicles",
                "Comedy",
                "Nonprofits & Activism",
            ],
        ),
        tooltip=[
            alt.Tooltip("year:O"),
            alt.Tooltip("cat_name"),
            alt.Tooltip("ranking:Q"),
        ],
    )
    .properties(
        title="Bump Chart",
        width=500,
        height=300,
    )
)

# è¶…æ–¹ä¾¿çš„å¤šå›¾å †å 
# (fig1 & fig2)
fig6 = (fig4 | fig5).configure_axis(grid=False).properties(title="Bye, hell subplots.")
fig6
```





<iframe id="fig6" frameborder=0 height="420px" width="100%" src="/files/charts/fig6.html"></iframe>


å¦‚ä¸Šå¯è§ï¼Œå›¾+å›¾çš„å †å åŠæ“æ§å°¤å…¶æ–¹ä¾¿ï¼Œç›´å‡ºç”»é¢çš„æ•ˆæœç®€æ´å¤§æ–¹ã€‚ç¼ºç‚¹å°±æ˜¯æ•°æ®é‡ä¸€å¤§ï¼ˆ5000ï¼‰å°±æŠ¥è­¦ã€‚

```python
MaxRowsError: The number of rows in your dataset is greater than the maximum allowed (5000).

Try enabling the VegaFusion data transformer which raises this limit by pre-evaluating data
transformations in Python.
    >> import altair as alt
    >> alt.data_transformers.enable("vegafusion")

Or, see https://altair-viz.github.io/user_guide/large_datasets.html for additional information
on how to plot large datasets.
```

## Plotly

Plotly ä¸ºæ»¡è¶³ã€Œçµæ´»è‡ªå®šä¹‰ã€ä»¥åŠã€Œå¼€ç®±å³ç”¨ã€çš„ä¸¤ç§éœ€æ±‚ï¼Œæä¾›äº†ä¸¤ç§ä¸åŒçš„é€”å¾„ã€‚ä¸€ç§åº•å±‚ APIï¼Œå¼ºè°ƒç²¾ç¡®æ§åˆ¶ï¼Œç§°ä½œ graphic_objectsï¼›ä¸€ç§ä¸Šå±‚ APIï¼Œå¼ºè°ƒç®€å•æ˜“ç”¨ï¼Œç§°ä½œ expressã€‚ä¸Šä¸€ç¯‡æ–‡ç« çš„å…¨éƒ¨å›¾è¡¨ï¼Œå‡å‡ºè‡ª Plotly æ¡†æ¶ã€‚ä¸€èˆ¬æ˜¯å…ˆç”¨ express å°è¯•ï¼Œexpress è¡¨è¾¾ä¸å‡ºæ¥çš„å›¾è¡¨ï¼Œå†ä½¿ç”¨ graphic_objects æç»˜ã€‚


```python
import plotly

plotly.__version__
```




    '5.18.0'




```python
import plotly.graph_objects as go
from plotly import express as px
from plotly.subplots import make_subplots
```


```python
fig7 = (
    # æ–¹å—çƒ­åŠ›å›¾åœ¨ plotly express ä¸­è¡¨è¿°ä¸º imshow
    px.imshow(
        # ä¸ºäº†è¿åˆ imshow çš„è¡¨è¾¾æ–¹å¼ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ‰æä¸€ä¸‹æ•°æ®
        heatmap_dat.pivot(index="month", columns="hour", values="n")
        .to_pandas()
        .set_index("month"),
        # æ•°æ®å‘ˆç°æ–¹å¼
        labels=dict(x="hour", y="month", color="n_videos"),
        color_continuous_scale="reds",
        # å›¾è¡¨é…ç½®
        template="plotly_white",
        title="Heatmap",
    ).update_layout(
        xaxis1=dict(showgrid=False),
        yaxis1=dict(showgrid=False),
    )
)

fig7
```


<iframe id="fig7" frameborder=0 height="450px" width="100%" src="/files/charts/fig7.html"></iframe>


åœ¨ Plotly é‡Œè¾¹å®ç° Bump Chart ä¹Ÿéœ€è¦æˆ‘ä»¬è‡ªè¡Œè®¾è®¡å®ç°æ–¹å¼ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä» express åˆ‡æ¢åˆ° graphic_objectsã€‚è¿™ä¸€åˆ‡æ¢è¿‡ç¨‹å¾€å¾€ä¼šç»™æˆ‘ä»¬é€ æˆä¸€äº›å›°æ‰°ï¼Œä¸»è¦æ¥æºäº API è®¾è®¡ä¸Šçš„ä¸å®Œå…¨å…¼å®¹ï¼Œæ¯”å¦‚åŒæ ·æ˜¯ç»˜åˆ¶æ•£ç‚¹å›¾ï¼Œè¿™ä¸¤å¥— API æ•£ç‚¹å›¾æ–¹æ³•æä¾›çš„å‚æ•°å¯èƒ½å°±ä¸ä¸€è‡´ï¼Œä»è€Œé€ æˆç†è§£åå·®ã€‚


```python
def plotly_bump(df):
    fig = go.Figure()

    # Bump Chart å¯ä»¥
    # ä¸ºæ¯ä¸€ä¸ªç±»åˆ«
    for name, data in df.group_by(["cat_name"]):
        name = name[0]
        trace = go.Scatter(
            x=data["year"],
            y=data["ranking"],
            mode="lines+markers",
            name=name,
            line=dict(width=2),
            marker=dict(size=10),
            text=name,
            hoverinfo="text",
            legendrank=data["ranking"][-1],
        )
        fig.add_trace(trace)

    fig.update_layout(
        title="Bump Chart",
        xaxis=dict(title="Year"),
        yaxis=dict(title="Rank"),
        legend=dict(title="Category"),
        yaxis_autorange="reversed",
        template="plotly_white",
        height=500,
        width=800,
        xaxis1=dict(showgrid=False),
        yaxis1=dict(showgrid=False),
    )

    return fig


fig8 = plotly_bump(bump_dat)
fig8
```


<iframe id="fig8" frameborder=0 height="500px" width="100%" src="/files/charts/fig8.html"></iframe>


å¯è§ï¼ŒPlotly è®¾è®¡çš„ figureã€traceã€layout, åŠå…¶å„é¡¹å±æ€§éƒ½æ˜¯è‡ªæˆä¸€æ´¾çš„ï¼Œå®ƒæœ‰è‡ªå·±é²œæ˜çš„ç‰¹è‰²ï¼Œé»˜è®¤çš„äº¤äº’æ•ˆæœä¹Ÿéå¸¸å¥½ï¼Œåªä¸è¿‡ ggplot2 è¿™ä¸€è„‰çš„ç”¨æˆ·ï¼Œéœ€è¦ä¸€ä¸ªä¹ æƒ¯çš„è¿‡ç¨‹ã€‚å¿«é€Ÿåˆ†ææ—¶æˆ‘å¾ˆå–œæ¬¢ç”¨ Plotly åšå¯è§†åŒ–ï¼Œä½†æ˜¯é‡åˆ°è‡ªå®šä¹‰åœºæ™¯æ—¶åˆå¾ˆå¤´ç—›ï¼Œå¾€å¾€éœ€è¦è€—è´¹å¾ˆå¤šæ—¶é—´å»æœç´¢ã€æŸ¥é˜…ã€‚


```python
def plotly_subplots():
    fig = make_subplots(rows=1, cols=2, subplot_titles=["Heatmap", "Bump Chart"])

    # Heatmap
    heatmap_trace = go.Heatmap(
        x=heatmap_dat["hour"],
        y=heatmap_dat["month"],
        z=heatmap_dat["n"],
        hoverongaps=False,
        opacity=0.7,
        colorscale="reds",
        colorbar=dict(x=0.45, y=0.5, len=1.1),
    )
    fig.add_trace(
        heatmap_trace,
        row=1,
        col=1,
    )

    # Bump Chart
    for name, data in bump_dat.group_by(["cat_name"]):
        name = name[0]
        trace = go.Scatter(
            x=data["year"],
            y=data["ranking"],
            mode="lines+markers",
            name=name,
            line=dict(width=2),
            marker=dict(size=10),
            text=name,
            hoverinfo="text",
            legendrank=data["ranking"][-1],
            legendgroup="2",
        )
        fig.add_trace(trace, row=1, col=2)

    # Update layout
    fig.update_layout(
        title_text="Heatmap and Bump Chart Side by Side",
        template="plotly_white",
        xaxis1=dict(showgrid=False),
        yaxis1=dict(showgrid=False),
        yaxis2_autorange="reversed",
        height=400,
        width=1300,
    )

    return fig


fig9 = plotly_subplots()
fig9
```


<iframe id="fig9" frameborder=0 height="500px" width="100%" src="/files/charts/fig9.html"></iframe>


èŠ±äº†ä¸å°‘æ—¶é—´è®©ä¸Šé¢çš„ä¸¤å¹…å›¾è¡¨æ’åœ¨ä¸€èµ·ï¼Œç»“è®ºæš‚æ—¶åªæœ‰ä¸€ä¸ªï¼šä¸è¦æŠ˜è…¾ Plotly çš„ subplotsï¼Œä¼šå˜å¾—ä¸å¹¸ã€‚

## Bokeh


```python
import bokeh

bokeh.__version__
```




    '3.3.3'



ä¸åƒç»å¤§å¤šæ•°çš„å›¾è¡¨åº“ï¼ŒBokeh å·²ç»ä¸å†å†…ç½®æ¨¡æ¿ APIï¼Œå³ä¾¿æœ€å¸¸è§çš„æ•£ç‚¹å›¾ã€æŠ˜çº¿å›¾ï¼Œä½¿ç”¨ Bokeh æ¥å®ç°ï¼Œçœ‹èµ·æ¥ä¹Ÿæ²¡æœ‰é‚£ä¹ˆç›´è§‚ï¼Œç»™äººä¸€ç§ä»åº•å±‚ä¸€ç –ä¸€ç“¦å¼€å§‹çš„åŸºå»ºæ„Ÿã€‚



```python
from bokeh.layouts import row
from bokeh.models import ColumnDataSource, Legend, LegendItem
from bokeh.plotting import figure, show, save
from bokeh.transform import factor_cmap, linear_cmap
from bokeh.io import output_notebook

output_notebook()
```


<style>
    .bk-notebook-logo {
        display: inline-block;
        width: 20px;
        height: 20px;
        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAOkSURBVDiNjZRtaJVlGMd/1/08zzln5zjP1LWcU9N0NkN8m2CYjpgQYQXqSs0I84OLIC0hkEKoPtiH3gmKoiJDU7QpLgoLjLIQCpEsNJ1vqUOdO7ppbuec5+V+rj4ctwzd8IIbbi6u+8f1539dt3A78eXC7QizUF7gyV1fD1Yqg4JWz84yffhm0qkFqBogB9rM8tZdtwVsPUhWhGcFJngGeWrPzHm5oaMmkfEg1usvLFyc8jLRqDOMru7AyC8saQr7GG7f5fvDeH7Ej8CM66nIF+8yngt6HWaKh7k49Soy9nXurCi1o3qUbS3zWfrYeQDTB/Qj6kX6Ybhw4B+bOYoLKCC9H3Nu/leUTZ1JdRWkkn2ldcCamzrcf47KKXdAJllSlxAOkRgyHsGC/zRday5Qld9DyoM4/q/rUoy/CXh3jzOu3bHUVZeU+DEn8FInkPBFlu3+nW3Nw0mk6vCDiWg8CeJaxEwuHS3+z5RgY+YBR6V1Z1nxSOfoaPa4LASWxxdNp+VWTk7+4vzaou8v8PN+xo+KY2xsw6une2frhw05CTYOmQvsEhjhWjn0bmXPjpE1+kplmmkP3suftwTubK9Vq22qKmrBhpY4jvd5afdRA3wGjFAgcnTK2s4hY0/GPNIb0nErGMCRxWOOX64Z8RAC4oCXdklmEvcL8o0BfkNK4lUg9HTl+oPlQxdNo3Mg4Nv175e/1LDGzZen30MEjRUtmXSfiTVu1kK8W4txyV6BMKlbgk3lMwYCiusNy9fVfvvwMxv8Ynl6vxoByANLTWplvuj/nF9m2+PDtt1eiHPBr1oIfhCChQMBw6Aw0UulqTKZdfVvfG7VcfIqLG9bcldL/+pdWTLxLUy8Qq38heUIjh4XlzZxzQm19lLFlr8vdQ97rjZVOLf8nclzckbcD4wxXMidpX30sFd37Fv/GtwwhzhxGVAprjbg0gCAEeIgwCZyTV2Z1REEW8O4py0wsjeloKoMr6iCY6dP92H6Vw/oTyICIthibxjm/DfN9lVz8IqtqKYLUXfoKVMVQVVJOElGjrnnUt9T9wbgp8AyYKaGlqingHZU/uG2NTZSVqwHQTWkx9hxjkpWDaCg6Ckj5qebgBVbT3V3NNXMSiWSDdGV3hrtzla7J+duwPOToIg42ChPQOQjspnSlp1V+Gjdged7+8UN5CRAV7a5EdFNwCjEaBR27b3W890TE7g24NAP/mMDXRWrGoFPQI9ls/MWO2dWFAar/xcOIImbbpA3zgAAAABJRU5ErkJggg==);
    }
</style>
<div>
    <a href="https://bokeh.org" target="_blank" class="bk-notebook-logo"></a>
    <span style="font-size:.8em;font-family:mono">Loading BokehJS ...</span>
</div>






```python
# éœ€è¦ Pandas DataFrame
fig10_dat = heatmap_dat.to_pandas()

# æ§åˆ¶çƒ­åŠ›å›¾ç»†èŠ‚
fig10 = figure(
    title="Heatmap",
    # å°æ—¶
    x_range=[str(x) for x in range(0, 24)],
    # æœˆä»½ï¼Œå¤šä¸€ä»½ç•™ç™½ï¼Œè®©æ¯ä¸ªå°æ ¼å­ç­‰å®½ç­‰é•¿
    y_range=[str(x) for x in range(1, 14)],
    x_axis_location="above",
    tools="",
    toolbar_location=None,
    tooltips=[("hour", "@hour"), ("month", "@month"), ("n", "@n")],
    width=600,
    height=300,
)

# å»æ‰å¹²æ‰°
fig10.grid.grid_line_color = None
fig10.axis.axis_line_color = None
fig10.axis.major_tick_line_color = None
fig10.outline_line_color = None

# æ˜ å°„æ•°æ®
fig10.rect(
    x="hour",
    y="month",
    width=1,
    height=1,
    source=fig10_dat,
    fill_color=linear_cmap(
        "n", "Reds256", high=fig10_dat.n.min(), low=fig10_dat.n.max(), nan_color="white"
    ),
    line_color=None,
)

# å±•ç¤ºå›¾è¡¨
show(fig10)
```



<iframe id="fig10" frameborder=0 height="310px" width="100%" src="/files/charts/fig10.html"></iframe>






```python
# åˆå§‹åŒ–å›¾è¡¨é…ç½®
fig11 = figure(
    title="Slope Graph",
    x_range=(2015.9, 2023.1),
    y_range=(17.5, 0.5),
    x_axis_location="above",
    tools="",
    toolbar_location=None,
    width=600,
    height=300,
    tooltips=[("category", "@cat_name"), ("ranking", "@ranking")],
)

# é¢„å…ˆè®¾å®š 17 ä¸ªåˆ†ç±»çš„é¢œè‰²æ˜ å°„å…³ç³»
cmap6 = factor_cmap(
    "cat_name",
    "Category20_17",
    sorted(bump_dat["cat_name"].unique()),
)

# é¢„å…ˆè®¾å®šå¥½å›¾ä¾‹æ’åº
fig11_legend_indexes = [
    "Science & Technology",
    "People & Blogs",
    "Film & Animation",
    "Education",
    "Gaming",
    "Entertainment",
    "Howto & Style",
    "Music",
    "Travel & Events",
    "Sports",
    "News & Politics",
    "Pets & Animals",
    "Autos & Vehicles",
    "Comedy",
    "Nonprofits & Activism",
    "Movies",
    "Trailers",
]

fig11_legend_items = []

# åˆ†åˆ«ç»˜åˆ¶æŠ˜çº¿å›¾å’Œæ•£ç‚¹å›¾ï¼Œå¹¶æŠŠå›¾ä¾‹ä¿¡æ¯ä¼ å‡ºæ¥
for name, data in bump_dat.group_by(["cat_name"]):
    src = data.to_pandas()
    name = name[0]
    line = fig11.line(
        x="year",
        y="ranking",
        source=src,
        line_width=2,
        line_color=cmap6.transform.palette[cmap6.transform.factors.index(name)],
    )
    scatter = fig11.scatter(
        x="year",
        y="ranking",
        source=src,
        size=8,
        color=cmap6.transform.palette[cmap6.transform.factors.index(name)],
    )

    fig11_legend_items.append(LegendItem(label=name, renderers=[line, scatter]))

# æ’é™¤å¹²æ‰°
fig11.grid.grid_line_color = None
fig11.axis.axis_line_color = None
fig11.axis.major_tick_line_color = None
fig11.outline_line_color = None
fig11.xaxis.minor_tick_out = 0
fig11.xaxis.major_tick_in = 0
fig11.yaxis.minor_tick_out = 0
fig11.yaxis.major_tick_in = 0

# å¾®è°ƒå›¾ä¾‹
fig11_legend_items_sorted = sorted(
    fig11_legend_items, key=lambda x: fig11_legend_indexes.index(x.label.value)
)
fig11.add_layout(Legend(items=fig11_legend_items_sorted, click_policy="mute"), "right")

# æ’é™¤å¹²æ‰°
fig11.legend.label_text_font_size = "6pt"
fig11.legend.glyph_height = 1
fig11.legend.spacing = 5
fig11.legend.label_height = 5
fig11.legend.location = (0, 0)
fig11.legend.background_fill_alpha = 0.6
fig11.legend.border_line_alpha = 0

# å±•ç¤ºå›¾è¡¨
show(fig11)
```



<iframe id="fig11" frameborder=0 height="320px" width="100%" src="/files/charts/fig11.html"></iframe>



è‡³äºå¤šå›¾å †å ï¼Œbokeh æä¾›äº†æ¸…æ™°çš„[æ–¹æ¡ˆ](https://docs.bokeh.org/en/latest/docs/user_guide/basic/layouts.html)ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œçš„ä¸€è¡Œä¸¤åˆ—ï¼Œç›´æ¥è°ƒç”¨ row æ–¹æ³•å³å¯ã€‚


```python
fig12 = row(fig10, fig11)
show(fig12)
```


<iframe id="fig12" frameborder=0 height="320px" width="100%" src="/files/charts/fig12.html"></iframe>



## å°ç»“

ä»Šå¹´åº”è¯¥ä¼šæ·±å…¥ä½¿ç”¨ Polars åŠå…¶èƒŒåçš„ hvPlotï¼Œä»¥åŠ hvPlot èƒŒåçš„ [HoloViz](https://holoviz.org/)ã€bokeh ç”Ÿæ€ï¼Œç»§ç»­å…³æ³¨ Altairã€‚å¦å¤–ï¼Œå°†å°è¯•å‡å°‘ Plotly çš„ä½¿ç”¨ï¼Œå¥½ç”¨æ˜¯å¥½ç”¨ï¼Œå¾®è°ƒä¹Ÿç¡®å®ç—›è‹¦ã€‚

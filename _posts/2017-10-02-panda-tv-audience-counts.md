---
layout: post
title:  "ç®€å•äº†è§£ç†ŠçŒ« TV çš„è§‚ä¼—ä½“é‡"
date:   2017-10-02 22:40 +0800
redirect_from:
  - 2017/10/02/panda-tv-audience-counts
---

æˆ‘çœ‹ç›´æ’­ã€‚ç»å¸¸åœ¨ç†ŠçŒ«çœ‹ Dota 1 å’Œ 2 çš„æ¯”èµ›ã€å¯¹é»‘ï¼Œä»Šå¤©æƒ³äº†è§£ä¸€ä¸‹å¤§æ¦‚çš„è§‚ä¼—äººæ•°ã€‚ä»…ç®€å•ç»Ÿè®¡äº†ç›´æ’­åˆ—è¡¨çš„ç¬¬ä¸€é¡µï¼Œæ•°æ®æ¥è‡ªç½‘é¡µä¸Šæ˜¾ç¤ºçš„è§‚ä¼—æ•°å€¼ï¼Œä¸æ±‚æ¢è®¨ã€Œç³»æ•°ã€æ˜¯å¤šå°‘ã€‚

æ™š 7:30 æ—¶çœ‹äº†ä¸€çœ¼ï¼Œç¬¬ä¸€é¡µè§‚ä¼—å…±è®¡ 873 ä¸‡å¤šï¼Œæœ€çƒ­ä¸»æ’­æœ‰è¿‘ 106 ä¸‡è§‚ä¼—ã€‚åˆ°æ™š 10:30 å·¦å³ï¼Œå†æ¬¡çœ‹äº†ä¸€ä¸‹ï¼Œè§‚ä¼—å±…ç„¶æ›´å¤šäº†ï¼Œåˆ°è¾¾ 1307 ä¸‡ï¼Œå¦‚ä¸‹å›¾ï¼Œæœ€çƒ­ä¸»æ’­è¿˜æ˜¯ä¹‹å‰æ’åœ¨æ¦œé¦–çš„ã€Œé”™è§‰è€ä¸­åŒ»ã€ï¼Œæ’­çš„èŠ‚ç›®æ˜¯ã€Œåƒé¸¡ã€â€¦â€¦ğŸ”â€¦â€¦

Winner winner, chicken dinner!

![panda tv audience counts](/files/2017/10/02/panda.tv.png)

ç®€å•æ¢³ç†ä¸€ä¸‹è„šæœ¬ï¼š

æ•°æ®è·å–ã€‚`$`ã€`$$`ã€`$x` ç­‰ç¬¦å·ï¼Œåœ¨ä¸»æµæµè§ˆå™¨é‡Œéƒ½å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œåˆ†åˆ«ä»£è¡¨ jQueryã€CSSã€XPath é€‰æ‹©å™¨ï¼Œé…Œæƒ…é€‰æ‹©è¶æ‰‹çš„ä¸€ç§å³å¯ã€‚ä¸åŒçš„é€‰æ‹©å™¨å¯¹åç»­æ•°æ®æ•´ç†çš„æ–¹å¼å¯èƒ½ç¨æœ‰å½±å“ï¼Œä½†ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ã€‚

æ•°æ®æ•´ç†ã€‚ä¸Šå›¾ä½¿ç”¨çš„ `$` æ–¹å¼ï¼Œæ‰€ä»¥ç›´æ¥è°ƒç”¨äº† jQuery `.text()` æ–¹æ³•å¹¶é€šè¿‡ `.split('äºº')` å°†å­—ç¬¦ä¸²æ‹†æˆæ•°ç»„ï¼Œå†åˆ©ç”¨ `.pop()` æ–¹æ³•åˆ¨æ‰æœ«å°¾ã€Œäººã€å­—å¤šäº§ç”Ÿçš„å…ƒç´ ï¼Œå¾—åˆ°ä¸€ä¸ªè§‚ä¼—åˆ—è¡¨ `["1172", "6.9ä¸‡", "6.7ä¸‡", "6.2ä¸‡", "5.9ä¸‡"...]`ã€‚å¦‚æœä¸æƒ³ç”¨ jQueryï¼Œ`$$` CSS é€‰æ‹©å™¨ä¹Ÿæ˜¯ç±»ä¼¼é“ç†ï¼Œ`$$('.video-number').map(function(x){return x.innerText})`ï¼Œå³åˆ©ç”¨ `map` å…ˆå–å¾— innerTextã€‚æœ€åï¼Œé€šè¿‡ `map` æ–¹æ³•ï¼Œå¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œå­—ç¬¦è½¬æ•°å­—ï¼Œå¸¦ã€Œä¸‡ã€çš„ä¹˜ä»¥ 10000ï¼Œä¸å¸¦åˆ™ä¿æŒä¸å˜ã€‚

æ•°æ®æ±‡æ€»ã€‚æœ€åé€šè¿‡ `reduce` æ–¹æ³•å¯¹æ•°ç»„å†…çš„æ‰€æœ‰æ•°å­—è¿›è¡Œç´¯åŠ ï¼Œå¾—åˆ°æƒ³è¦çš„æ€»è§‚ä¼—äººæ•°ã€‚

```
var n = $('.video-number').text().split('äºº');
n.pop();
n = n.map(function(x) {
  if (x.includes('ä¸‡')) {
    return parseFloat(x.replace(/ä¸‡/i, '')) * 10000
  } else {
    return parseFloat(x)
  }
});
var r = n.reduce(function(a, c) { return a + c });
r;
```

ä¸è¿‡ï¼Œä¼¼ä¹ä¸‹é¢è¿™ä¸€ç§ï¼Œé€»è¾‘ç¨å¾®æ¸…æ™°ä¸€ç‚¹ï¼š

```
var n = $$('.video-number')
  .map(function(x) { return x.innerText })
  .map(function(x) {
    if (x.includes('ä¸‡äºº')) {
      return parseFloat(x.replace(/ä¸‡äºº/i, '')) * 10000
    } else {
      return parseFloat(x.replace(/äºº/i, ''))
    }
  });
var r = n.reduce(function(a, c) { return a + c });
r;
```

æ–—é±¼ï¼š

```
var n = $$('.dy-num').map(function(x){return x.innerText}).map(function(x){if(x.includes('ä¸‡')){return parseFloat(x.replace(/ä¸‡/, '')*10000)}else{return parseFloat(x)}});var r = n.reduce(function(a, c){return a + c});r;
```

è™ç‰™ï¼š

```
var n = $$('.js-num').map(function(x){return x.innerText}).map(function(x){if(x.includes('ä¸‡')){return parseFloat(x.replace(/ä¸‡/, '')*10000)}else{return parseFloat(x)}});var r = n.reduce(function(a, c){return a + c});r;
```

